# 智能人脸识别系统

基于PyQt5和dlib的智能人脸识别考勤系统

## 系统功能

- **人脸识别**：实时人脸检测和识别
- **人脸录入**：支持摄像头录入和图片录入
- **数据管理**：用户信息管理和数据导出
- **考勤管理**：自动考勤记录和报表生成
- **API服务**：提供RESTful API接口
- **MySQL数据库**：支持本地MySQL数据库存储

## 修复内容

### 1. 人脸录入预览修复
- 修复了人脸录入时预览区域没有摄像头界面的问题
- 现在录入摄像头画面会正确显示在录入预览区域
- 优化了摄像头启动和停止的状态管理

### 2. MySQL数据库支持
- 将原来的SQLite数据库改为MySQL数据库
- 默认配置：
  - 主机：localhost
  - 端口：3306
  - 用户：root
  - 密码：123456
  - 数据库名：smart_attendance
- 系统会自动创建所需的数据库和表结构

### 3. 考勤管理优化
- 开始考勤时会自动启动摄像头
- 优化了考勤检测逻辑
- 考勤记录会同时保存到本地和MySQL数据库

## 安装说明

### 环境要求
- Python 3.7+
- MySQL 5.7+
- Windows/macOS/Linux

### 安装步骤

1. **克隆或下载项目**

2. **安装依赖包**
```bash
pip install -r requirements.txt
```

3. **配置MySQL数据库**
   - 确保MySQL服务已启动
   - 验证root用户密码是否为123456
   - 系统会自动创建数据库和表

4. **下载模型文件**
   需要将以下模型文件放在models目录下：
   - shape_predictor_68_face_landmarks.dat
   - dlib_face_recognition_resnet_model_v1.dat
   
   可以从dlib官方网站下载：
   - http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2
   - http://dlib.net/files/dlib_face_recognition_resnet_model_v1.dat.bz2

5. **运行系统**
```bash
python main_fixed.py
```

## 使用说明

### 人脸识别
1. 点击"启动摄像头"按钮
2. 点击"开始识别"按钮进行实时识别
3. 识别结果会显示在界面上

### 人脸录入
1. 填写人员信息（姓名、年龄、性别、部门）
2. 选择录入方式：
   - 摄像头录入：点击"启动摄像头录入"，然后点击"捕获人脸"
   - 图片录入：点击"选择图片录入"选择人脸图片
3. 点击"保存信息"完成录入

### 数据管理
- 查看所有录入的用户信息
- 支持删除和导出数据
- 点击"刷新数据"获取最新信息

### 考勤管理
1. 点击"开始考勤"按钮（系统会自动启动摄像头）
2. 系统会自动检测人脸并记录考勤
3. 点击"停止考勤"结束考勤
4. 点击"生成报表"查看考勤统计

### 系统设置
- 可以修改模型路径、数据库配置等参数
- 修改后需要点击"保存设置"生效

## 注意事项

1. **摄像头权限**
   - 确保应用程序有摄像头访问权限
   - 如果有多个摄像头，可以在设置中修改摄像头索引

2. **模型文件**
   - 模型文件较大（约100MB+），需要确保下载完整
   - 模型文件路径可以在设置中修改

3. **数据库连接**
   - 如果MySQL连接失败，请检查：
     - MySQL服务是否启动
     - 用户名密码是否正确
     - 网络连接是否正常

4. **性能优化**
   - 人脸识别对CPU要求较高，建议使用性能较好的电脑
   - 可以调整识别频率来优化性能

## 常见问题

### Q: 启动时提示模型文件缺失
A: 请确保models目录下有完整的模型文件，或者在设置中指定正确的模型路径。

### Q: MySQL连接失败
A: 请检查MySQL服务是否启动，用户名密码是否正确，网络连接是否正常。

### Q: 摄像头无法启动
A: 请检查摄像头是否正常工作，应用程序是否有摄像头访问权限。

### Q: 人脸识别准确率低
A: 请确保：
   - 光线条件良好
   - 人脸正面朝向摄像头
   - 背景不要过于复杂
   - 可以调整识别阈值

## 技术支持

如果遇到问题，请查看系统日志获取详细信息，或联系技术支持。

## 更新日志

### v1.0 (2025-11-06)
- 修复人脸录入预览问题
- 迁移到MySQL数据库
- 优化考勤管理功能
- 完善系统稳定性